import XCTest
import Hitch
import class Foundation.Bundle

@testable import Sextant

class ExamplesTest: TestsBase {
    
    /// Each call to Sextant's query(values: ) will return an array on success and nil on failure
    func testSimple0() {
        let json = #"["Hello","World"]"#
        guard let results = json.query(values: "$[0]") else { return XCTFail() }
        XCTAssertEqualAny(results[0], "Hello")
    }
    
    /// You can avoid the provided extensions and call query on the Sextant singleton directly
    func testSimple1() {
        let json = #"["Hello","World"]"#
        guard let jsonData = json.data(using: .utf8) else { return }
        guard let jsonObject = try? JSONSerialization.jsonObject(with: jsonData, options: []) else { return }
        guard let results = Sextant.shared.query(jsonObject, values: "$[0]") else { return XCTFail() }
        XCTAssertEqualAny(results[0], "Hello")
    }
    
    /// Works with any existing JSON-like structure
    func testSimple2() {
        let data = [ "Hello", "World" ]
        guard let results = data.query(values: "$[0]") else { return XCTFail() }
        XCTAssertEqualAny(results[0], "Hello")
    }
    
    /// Automatically covert to simple tuples
    func testSimple3() {
        let json = #"{"name":"Rocco","age":42}"#
        
        guard let person: (name: String?, age: Int?) = json.query("$.['name','age']") else { return XCTFail() }
        XCTAssertEqual(person.name, "Rocco")
        XCTAssertEqual(person.age, 42)
    }
    
    func testSimple4() {
        let json = #"{"data":{"attributes":{"about":null,"apple_id":null,"can_see_nsfw":null,"created":"2017-06-11T14:34:25.000+00:00","default_country_code":null,"discord_id":null,"email":"rocco@chimerasw.com","facebook":null,"facebook_id":null,"first_name":"Rocco","full_name":"Rocco Bowling","gender":0,"google_id":null,"has_password":true,"image_url":"https://c10.patreonusercontent.com/3/eyJ3IjoyMDB9/patreon-media/p/user/6488177/46e7884e66724bdb82cbb32e69c4e172/1.png?token-time=2145916800&token-hash=29ZN76xhe4lSDUDHbxbGwsY8W3navRH05IhkRv01O7A%3D","is_deleted":false,"is_email_verified":true,"is_nuked":false,"is_suspended":false,"last_name":"Bowling","patron_currency":"USD","social_connections":{"deviantart":null,"discord":null,"facebook":null,"google":null,"instagram":null,"reddit":null,"spotify":null,"twitch":null,"twitter":null,"vimeo":null,"youtube":null},"thumb_url":"https://c10.patreonusercontent.com/3/eyJ3IjoyMDB9/patreon-media/p/user/6488177/46e7884e66724bdb82cbb32e69c4e172/1.png?token-time=2145916800&token-hash=29ZN76xhe4lSDUDHbxbGwsY8W3navRH05IhkRv01O7A%3D","twitch":null,"twitter":null,"url":"https://www.patreon.com/user?u=6488177","vanity":null,"youtube":null},"id":"6488177","relationships":{"campaign":{"data":{"id":"985118","type":"campaign"},"links":{"related":"https://www.patreon.com/api/campaigns/985118"}},"pledges":{"data":[]}},"type":"user"},"included":[{"attributes":{"avatar_photo_url":"https://c10.patreonusercontent.com/3/eyJ3IjoyMDB9/patreon-media/p/campaign/985118/0fbd5be5576b40678347352de10f439f/1.png?token-time=2145916800&token-hash=KLLEfr1wh5ibvrjItZmymaClfKy5_6gmaW8DmQuRRFA%3D","campaign_pledge_sum":0,"cover_photo_url":"https://c10.patreonusercontent.com/3/eyJ3IjoxOTIwLCJ3ZSI6MX0%3D/patreon-media/p/campaign/985118/6d85a53aa8304815b7a2fc4371fbed62/5.png?token-time=1638576000&token-hash=C8buh7Z7EKhywLcrGJC9zYLOkDvT062Va5JpJ2giRQM%3D","cover_photo_url_sizes":{"large":"https://c10.patreonusercontent.com/3/eyJ3IjoxOTIwLCJ3ZSI6MX0%3D/patreon-media/p/campaign/985118/6d85a53aa8304815b7a2fc4371fbed62/5.png?token-time=1638576000&token-hash=C8buh7Z7EKhywLcrGJC9zYLOkDvT062Va5JpJ2giRQM%3D","medium":"https://c10.patreonusercontent.com/3/eyJ3Ijo5NjAsIndlIjoxfQ%3D%3D/patreon-media/p/campaign/985118/6d85a53aa8304815b7a2fc4371fbed62/5.png?token-time=1638576000&token-hash=nUdQsJt9OAGT1UeE5mqYjoVi1quSURiSLskYi20g1TQ%3D","small":"https://c10.patreonusercontent.com/3/eyJ3Ijo2MjAsIndlIjoxfQ%3D%3D/patreon-media/p/campaign/985118/6d85a53aa8304815b7a2fc4371fbed62/5.png?token-time=1638576000&token-hash=TEwIIbyCZWz2yd_b6jfqD89VgouIW0KSUA5S0o2EETY%3D"},"created_at":"2017-06-11T14:34:49.000+00:00","creation_count":0,"creation_name":"Starbase Orion 10","currency":"USD","discord_server_id":"794786561765670915","display_patron_goals":false,"earnings_visibility":"public","image_small_url":"https://c10.patreonusercontent.com/3/eyJ3IjoxOTIwLCJ3ZSI6MX0%3D/patreon-media/p/campaign/985118/6d85a53aa8304815b7a2fc4371fbed62/5.png?token-time=1638576000&token-hash=C8buh7Z7EKhywLcrGJC9zYLOkDvT062Va5JpJ2giRQM%3D","image_url":"https://c10.patreonusercontent.com/3/eyJ3IjoxOTIwLCJ3ZSI6MX0%3D/patreon-media/p/campaign/985118/6d85a53aa8304815b7a2fc4371fbed62/5.png?token-time=1638576000&token-hash=C8buh7Z7EKhywLcrGJC9zYLOkDvT062Va5JpJ2giRQM%3D","is_charge_upfront":true,"is_charged_immediately":true,"is_monthly":true,"is_nsfw":false,"is_plural":false,"main_video_embed":null,"main_video_url":null,"name":"Rocco Bowling","one_liner":null,"outstanding_payment_amount_cents":0,"patron_count":0,"pay_per_name":"month","pledge_sum":0,"pledge_sum_currency":"USD","pledge_url":"/join/starbaseorion10","published_at":null,"summary":"<strong>&quot;The best 4X game currently available for mobile&quot; </strong>- PocketTactics.com<br><strong>&quot;This one is geek heaven&quot;</strong> - AppAdvice.com<br><strong>&quot;Master of Orion in Your Pocket” </strong>- GamePro.com<br><strong>&quot;Starbase Orion has an epic-feeling&quot;</strong> - TouchArcade.com<br><strong>&quot;Starbase Orion is here, and it's glorious.&quot;</strong> - TUAW.com<br><br><strong>Join my patreon and the Starbase Orion community as we work together to create the best multiplayer 4x space strategy game in existence!</strong><br><br>In October of 2011 I released <a href=\"https://apps.apple.com/us/app/starbase-orion/id438375580\" target=\"_blank\">Starbase Orion</a>; it grew to be one of the <strong>most accomplished turn-based 4x space strategy games on iOS</strong>. Starbase Orion quickly attracted a community of 4x fans eager for galactic battles the bards would write songs about.<br><br>Spam the turn button and advance life a few years. Starbase Orion is still available today but its age is showing. The code is ancient, relying on technologies which long ago rode off into the sunset.  In July of 2020 I wrote the first few lines of code which began the long journey to create the <strong>Starbase Orion 10 Year Anniversary</strong> edition (SO10).<br><br><div style=\"margin-left: 20px;\"><strong>Community driven development</strong><br>Starbase Orion has always been a one developer project, but that does not describe the sum of its contributions. Many of the great features, game balance decisions, and more were directly suggested by members of the Starbase Orion community. This patreon will continue that tradition, by providing a safe place for community members to directly influence Starbase Orion 10.<br><br><strong>All players are welcome</strong><br>One cannot have the best multiplayer experience and value strong community while at the same time limiting the player-base to a select platform. Thankfully technologies have advanced greatly in the last 10 years and I am happy to announce that Starbase Orion 10 can be enjoyed by just about everyone.<br><br><strong>The best multiplayer experience possible</strong><br>This is the core of Starbase Orion and its vision can be felt in all aspects of the game. In a genre where multiplayer is an after-thought, core gameplay decisions in Starbase Orion must work equally well for single player and multiplayer.<br><br><strong>The journey is just beginning</strong><br>At the time of this writing, Starbase Orion 10 has entered an alpha release; it still has a long way to go! If you enjoy getting in on the ground early and contributing to a mighty endeavor, then this is the place to be. If you're looking for a complete and fully functional game, then you are best served waiting a bit.<br><br></div>","thanks_embed":null,"thanks_msg":null,"thanks_video_url":null,"url":"https://www.patreon.com/user?u=6488177"},"id":"985118","relationships":{"creator":{"data":{"id":"6488177","type":"user"},"links":{"related":"https://www.patreon.com/api/user/6488177"}},"goals":{"data":[]},"rewards":{"data":[{"id":"-1","type":"reward"},{"id":"0","type":"reward"},{"id":"6596694","type":"reward"},{"id":"6599540","type":"reward"},{"id":"6596695","type":"reward"},{"id":"6596696","type":"reward"},{"id":"6599527","type":"reward"},{"id":"6599526","type":"reward"}]}},"type":"campaign"},{"attributes":{"amount":0,"amount_cents":0,"created_at":null,"description":"Everyone","patron_currency":"USD","remaining":0,"requires_shipping":false,"url":null,"user_limit":null},"id":"-1","type":"reward"},{"attributes":{"amount":1,"amount_cents":1,"created_at":null,"description":"Patrons Only","patron_currency":"USD","remaining":0,"requires_shipping":false,"url":null,"user_limit":null},"id":"0","type":"reward"},{"attributes":{"amount":500,"amount_cents":500,"created_at":"2021-01-16T02:59:22.849+00:00","currency":"USD","description":"","discord_role_ids":["800068003554525194"],"edited_at":"2021-01-16T18:58:54.723+00:00","image_url":"https://c10.patreonusercontent.com/3/eyJ3Ijo0MDB9/patreon-media/p/reward/6596694/d7c00262a9e147179a689fdaa0c95409/1.png?token-time=2145916800&token-hash=qSHsNSEk962HUb92fMFLM2xGf9HqDHbB5NhukoI6nEs%3D","patron_amount_cents":500,"patron_count":0,"patron_currency":"USD","post_count":0,"published":true,"published_at":"2021-01-16T18:58:54.710+00:00","remaining":null,"requires_shipping":false,"title":"Colonist","unpublished_at":null,"url":"/join/starbaseorion10/checkout?rid=6596694","user_limit":null,"welcome_message":null,"welcome_message_unsafe":null,"welcome_video_embed":null,"welcome_video_url":null},"id":"6596694","relationships":{"campaign":{"data":{"id":"985118","type":"campaign"},"links":{"related":"https://www.patreon.com/api/campaigns/985118"}}},"type":"reward"},{"attributes":{"amount":1500,"amount_cents":1500,"created_at":"2021-01-16T18:20:33.764+00:00","currency":"USD","description":"","discord_role_ids":["800068037964595210"],"edited_at":"2021-10-11T20:25:57.810+00:00","image_url":"https://c10.patreonusercontent.com/3/eyJ3Ijo0MDB9/patreon-media/p/reward/6599540/d327cf7638ef4af6a8ee3faaa97f0793/1.png?token-time=2145916800&token-hash=sBFqY5W7OxSK29Ggzi-gu4JAz9WYqRknUhktJzP_i9U%3D","patron_amount_cents":1500,"patron_count":0,"patron_currency":"USD","post_count":0,"published":true,"published_at":"2021-10-11T20:25:57.796+00:00","remaining":null,"requires_shipping":false,"title":"Colonial Governor","unpublished_at":null,"url":"/join/starbaseorion10/checkout?rid=6599540","user_limit":null,"welcome_message":null,"welcome_message_unsafe":null,"welcome_video_embed":null,"welcome_video_url":null},"id":"6599540","relationships":{"campaign":{"data":{"id":"985118","type":"campaign"},"links":{"related":"https://www.patreon.com/api/campaigns/985118"}}},"type":"reward"},{"attributes":{"amount":4000,"amount_cents":4000,"created_at":"2021-01-16T02:59:23.262+00:00","currency":"USD","description":"","discord_role_ids":["800068167737147413"],"edited_at":"2021-10-11T20:27:21.165+00:00","image_url":"https://c10.patreonusercontent.com/3/eyJ3Ijo0MDB9/patreon-media/p/reward/6596695/12905d7e54104ef19f4131ef710d0a0f/1.png?token-time=2145916800&token-hash=t7sgYZ9wxcxDQB7njCk1BPdmu-p1NXX51LgtOI86NIQ%3D","patron_amount_cents":4000,"patron_count":0,"patron_currency":"USD","post_count":0,"published":true,"published_at":"2021-10-11T20:27:21.146+00:00","remaining":null,"requires_shipping":false,"title":"Fleet Commander","unpublished_at":null,"url":"/join/starbaseorion10/checkout?rid=6596695","user_limit":null,"welcome_message":null,"welcome_message_unsafe":null,"welcome_video_embed":null,"welcome_video_url":null},"id":"6596695","relationships":{"campaign":{"data":{"id":"985118","type":"campaign"},"links":{"related":"https://www.patreon.com/api/campaigns/985118"}}},"type":"reward"},{"attributes":{"amount":10000,"amount_cents":10000,"created_at":"2021-01-16T02:59:23.706+00:00","currency":"USD","description":"","discord_role_ids":["800068194622504981"],"edited_at":"2021-10-11T20:28:35.571+00:00","image_url":"https://c10.patreonusercontent.com/3/eyJ3Ijo0MDB9/patreon-media/p/reward/6596696/0e89741277124f349d5411b513dbed17/3.png?token-time=2145916800&token-hash=aKgre3ntP8Y7tH4kHp6TUszEToLITp1zNAKA_iD-C6s%3D","patron_amount_cents":10000,"patron_count":0,"patron_currency":"USD","post_count":0,"published":true,"published_at":"2021-10-11T20:28:35.553+00:00","remaining":null,"requires_shipping":false,"title":"Homeworld Magistrate","unpublished_at":null,"url":"/join/starbaseorion10/checkout?rid=6596696","user_limit":null,"welcome_message":null,"welcome_message_unsafe":null,"welcome_video_embed":null,"welcome_video_url":null},"id":"6596696","relationships":{"campaign":{"data":{"id":"985118","type":"campaign"},"links":{"related":"https://www.patreon.com/api/campaigns/985118"}}},"type":"reward"},{"attributes":{"amount":50000,"amount_cents":50000,"created_at":"2021-01-16T18:17:37.984+00:00","currency":"USD","description":"","discord_role_ids":["800068229862129724"],"edited_at":"2021-01-16T19:34:30.787+00:00","image_url":"https://c10.patreonusercontent.com/3/eyJ3Ijo0MDB9/patreon-media/p/reward/6599527/5d34cbc661e24874ae50d1d02dabe64e/2.png?token-time=2145916800&token-hash=-KlBv48pGBLCtrAHszBaoFH74RT6yg5D_VwWfcDj364%3D","patron_amount_cents":50000,"patron_count":0,"patron_currency":"USD","post_count":0,"published":true,"published_at":"2021-01-16T19:34:30.769+00:00","remaining":null,"requires_shipping":false,"title":"Advisor to the Emperor","unpublished_at":null,"url":"/join/starbaseorion10/checkout?rid=6599527","user_limit":null,"welcome_message":null,"welcome_message_unsafe":null,"welcome_video_embed":null,"welcome_video_url":null},"id":"6599527","relationships":{"campaign":{"data":{"id":"985118","type":"campaign"},"links":{"related":"https://www.patreon.com/api/campaigns/985118"}}},"type":"reward"},{"attributes":{"amount":100000,"amount_cents":100000,"created_at":"2021-01-16T18:17:14.191+00:00","currency":"USD","description":"","discord_role_ids":["800068640019316736"],"edited_at":"2021-01-16T20:00:46.191+00:00","image_url":"https://c10.patreonusercontent.com/3/eyJ3Ijo0MDB9/patreon-media/p/reward/6599526/d1ae98d8c0c446989490693cf1fa9293/2.png?token-time=2145916800&token-hash=tPmLYKZPhnAgcgedyZol2-LKTZ72_H9Qn5EUKDh3DzI%3D","patron_amount_cents":100000,"patron_count":0,"patron_currency":"USD","post_count":0,"published":true,"published_at":"2021-01-16T20:00:46.174+00:00","remaining":null,"requires_shipping":false,"title":"Interstellar Angel","unpublished_at":null,"url":"/join/starbaseorion10/checkout?rid=6599526","user_limit":null,"welcome_message":null,"welcome_message_unsafe":null,"welcome_video_embed":null,"welcome_video_url":null},"id":"6599526","relationships":{"campaign":{"data":{"id":"985118","type":"campaign"},"links":{"related":"https://www.patreon.com/api/campaigns/985118"}}},"type":"reward"}],"links":{"self":"https://www.patreon.com/api/user/6488177"}}"#
        let jsonData = json.parsed()
        
        if let fullName: String = jsonData.query("$.data.attributes['full_name']") {
            XCTAssertEqual(fullName, "Rocco Bowling")
        }
    }
}

extension ExamplesTest {
    static var allTests : [(String, (ExamplesTest) -> () throws -> Void)] {
        return [
            ("testSimple0", testSimple0),
            ("testSimple1", testSimple1),
            ("testSimple2", testSimple2),
        ]
    }
}

